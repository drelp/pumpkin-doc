<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pumpkin一站式融合计算平台 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Pumpkin一站式融合计算平台 Blog Atom Feed"><title data-react-helmet="true">部署Harbor仓库 | Pumpkin一站式融合计算平台</title><meta data-react-helmet="true" property="og:url" content="https://pumpkin.dev/docs/deployment/harbor"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="部署Harbor仓库 | Pumpkin一站式融合计算平台"><meta data-react-helmet="true" name="description" content="本文档为 Harbor 私有云仓库 部署说明，通过 Harbor 服务，实现南瓜生物云平台中各类运行镜像的管理与维护及代码仓 heml 包管理，管理的镜像主要分为如下两类："><meta data-react-helmet="true" property="og:description" content="本文档为 Harbor 私有云仓库 部署说明，通过 Harbor 服务，实现南瓜生物云平台中各类运行镜像的管理与维护及代码仓 heml 包管理，管理的镜像主要分为如下两类："><link data-react-helmet="true" rel="shortcut icon" href="/img/pumpkin-doc-pic.svg"><link data-react-helmet="true" rel="canonical" href="https://pumpkin.dev/docs/deployment/harbor"><link data-react-helmet="true" rel="alternate" href="https://pumpkin.dev/en/docs/deployment/harbor" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pumpkin.dev/docs/deployment/harbor" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://pumpkin.dev/docs/deployment/harbor" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c7ca059f.css">
<link rel="preload" href="/assets/js/runtime~main.a24ae582.js" as="script">
<link rel="preload" href="/assets/js/main.b78f448d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_5xi4 shadow--md">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/pumpkin_logo.svg" alt="Pumpkin Logo" class="themedImage_xbOu themedImage--light_iLzQ navbar__logo"><img src="/img/pumpkin_logo.svg" alt="Pumpkin Logo" class="themedImage_xbOu themedImage--dark_fEq9 navbar__logo"><b class="navbar__title">Pumpkin</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/intro">文档</a></div><div class="navbar__items navbar__items--right"><a href="https://git.yunqiic.com/Yunqiic/pumpkin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>托管平台<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_9d7E"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_AzP0 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_psqr">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_psqr">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_7sPf"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_u8-6 searchBarLoadingRing_tzWQ"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/pumpkin_logo.svg" alt="Pumpkin Logo" class="themedImage_xbOu themedImage--light_iLzQ navbar__logo"><img src="/img/pumpkin_logo.svg" alt="Pumpkin Logo" class="themedImage_xbOu themedImage--dark_fEq9 navbar__logo"><b class="navbar__title">Pumpkin</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/introduction/intro">文档</a></li><li class="menu__list-item"><a href="https://git.yunqiic.com/Yunqiic/pumpkin" target="_blank" rel="noopener noreferrer" class="menu__link"><span>托管平台<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_9d7E"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_DTvP"><aside class="docSidebarContainer_1mIz"><div class="sidebar_Qqgd"><nav class="menu menu--responsive thin-scrollbar menu_wDB2" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_a3YD" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">概览</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/intro">平台简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/knowledge">基础知识</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/arch">平台架构</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">部署指南</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/environment">环境依赖</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/kubernetes">部署Kubernetes集群</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/deployment/harbor">部署Harbor仓库</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/stoarge">部署共享存储</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">部署南瓜系统</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/deploy/quick_deploy">快速部署</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/deploy/source_deploy">源码部署</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/faq">常见问题</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">使用手册</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/intro">用户使用说明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/overview">概览</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/data">数据管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/algorithm">算法管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/deployment">模型开发</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/image">镜像管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/train">训练管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/model">模型管理</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">实践案例</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/use_case/detectron2">目标检测模型训练</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/workspace">群组空间</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/faq">常见问题</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">管理手册</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/intro">后台管理说明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/metrics">平台监控</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/user">用户管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/resource">资源管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/bill">机时管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/data">数据管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/algorithm">算法管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/image">镜像管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/deployment">开发管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/train">训练管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/model">模型管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/faq">常见问题</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/management/platform">平台管理</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">进阶开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/arch">架构设计</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/notebook_image">Notebook镜像制作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/apidoc">API文档</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">开源社区</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/community/code_of_conduct">贡献者行为准则契约</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/community/contribution">开源贡献指南</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/community/issue-temp-and-dev-process">Issue模板及开发流程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/community/pr-template">Pull Request 规范</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/community/LICENSE">开源许可证书</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_ktqT"><div class="container padding-top--md padding-bottom--lg docItemWrapper_OfI5"><div class="row"><div class="col docItemCol_H7FE"><div class="docItemContainer_C+Ke"><article><div class="markdown"><header><h1 class="h1Heading_Qw0s">部署Harbor仓库</h1></header><p>本文档为 Harbor 私有云仓库 部署说明，通过 Harbor 服务，实现南瓜生物云平台中各类运行镜像的管理与维护及代码仓 heml 包管理，管理的镜像主要分为如下两类： </p><ol><li>模型管理模块中 notebook 的运行镜像，用于算法的在线编辑与开发功能。</li><li>训练管理模块中训练任务的运行镜像，用于模型训练算法的运行载体。</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>南瓜生物云推荐使用 harbor 版本为 2.3.0。同时，考虑到用户在本地可能已经部署有 harbor 仓库的其他版本, 而不同版本存在 api 接口调用的差异，因此南瓜生物云在后端服务配置 base-server/configs/config.yaml 文件中，提供了 harbor 版本的 apiVersion 属性字段，用户可根据实际的 harbor 版本对该字段进行修改，从而实现 harbor 版本控制和兼容（具体详见镜像管理服务代码）。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_uCgO" id="整体部署"></a>整体部署<a class="hash-link" href="#整体部署" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_uCgO" id="安装-docker"></a>安装 docker<a class="hash-link" href="#安装-docker" title="Direct link to heading">#</a></h3><ul><li>更新 apt 包索引</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ console"><pre tabindex="0" class="prism-code language-console codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt-get update</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>安装以下包使 apt 可以通过 HTTPS 使用存储库</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ console"><pre tabindex="0" class="prism-code language-console codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt-get install -y apt-transport-https ca-certificates curl software-properties-common</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>添加 docker 官方的 GPG 密钥</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>设置 stable 存储库</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>更新 apt 包索引</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt-get update</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>安装最新的 docker 安装包</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt-get install -y docker-ce</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>启动 docker 并验证</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl enable docker</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start docker</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl status docker</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_uCgO" id="安装-docker-compose"></a>安装 docker-compose<a class="hash-link" href="#安装-docker-compose" title="Direct link to heading">#</a></h3><ul><li>下载 docker-compose</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -L https://get.daocloud.io/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` &gt;/usr/local/bin/docker-compose</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x /usr/local/bin/docker-compose</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>查看 docker-compose 的版本信息</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose --version</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_uCgO" id="安装-python-文件"></a>安装 python 文件<a class="hash-link" href="#安装-python-文件" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt-get update</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt-get install python2.7</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt update</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt install python-pip</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip install --upgrade pip</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_uCgO" id="安装-harbor"></a>安装 harbor<a class="hash-link" href="#安装-harbor" title="Direct link to heading">#</a></h3><ul><li>下载离线安装包（也可以去 github 下载 <a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener noreferrer">https://github.com/goharbor/harbor/releases</a> ）</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://storage.googleapis.com/harbor-releases/harbor-offline-installer-v2.2.3.tgz</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>改名、解压文件然后移动到指定文件夹下面</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mv harbor-offline-installer-v2.2.3.tgz  harbor.tgz</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -zxvf  harbor-offline-installer-v2.2.3.tgz</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mv harbor /usr/local/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>进入 harbor 目录，修改 harbor 配置文件</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd harbor</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vi harbor.cfg</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1) 将 hostname 修改为域名</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2) 将 ui_url_protocol 设置为 ui_url_protocol=https</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3) 创建文件夹用来存放证书 mkdir -p /data/cert</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>进入 cert 目录生成证书</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl genrsa -des3 -out server.key 2048</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl req -new -key server.key -out server.csr</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp server.key server.key.org</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl rsa -in server.key.org -out server.key</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod a+x *</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>修改 linux 的 hosts 内容</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">vi /etc/hosts</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">格式：ip地址 域名(与 harbor.cfg 里面的域名一致)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>修改 docker 的配置文件 daemon.json 文件(执行命令 systemctl daemon-reload 重新加载配置)</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">insecure-registries&quot;: [&quot;https://域名&quot;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>进入 harbor 目录执行命令</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./install.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>登陆到 Harbor 上面</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker login https://域名</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">默认账号：admin</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">默认密码：Harbor12345</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_uCgO" id="harbor-使用"></a>Harbor 使用<a class="hash-link" href="#harbor-使用" title="Direct link to heading">#</a></h2><p>要在客户机浏览器上登录 Harbor， 请先配置 Harbor 域名解析，或者修改 hosts 文件进行本地解析:</p><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Windows 系统: C:\Windows\System32\drivers\etc\hosts  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Linux 系统: /etc/hosts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><p>在 hosts 文件中添加 Harbor 服务器 IP 以及配置的 Harbor 域名，如：</p><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">192.168.202.110  cicd2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><p>然后在浏览器输入 Harbor 域名:</p><p><img alt="image-20210721164613401" src="/assets/images/image-20210721164613401-440c10b617f7e113585fa3a45afe7223.png"></p><p>默认登录名为 admin，初始密码为 Harbor12345，登录后，新建项目 train (项目中要用到，请务必创建)，并设置存储的容量大小：</p><p><img alt="image-20210721165125064" src="/assets/images/image-20210721165125064-21a451eafe123e806b3a53c29b49a8f6.png"></p><p>新建项目后，即可使用镜像命令上传镜像到 Harbor 仓库 train 项目中了。以 alpine 镜像为例，拉取镜像并 push 到 harbor 私有仓库流程如下：</p><ul><li>首先拉取 alpine：latest 版本：</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo docker pull alpine</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><p><img alt="image-20210721170037189" src="/assets/images/image-20210721170037189-a0e603a4ceab34f637dbdcb4de40cf5b.png"></p><ul><li>本地给镜像打 tag：</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo docker tag  alpine:latest  192.168.202.110:5000/train/alpine:latest</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><ul><li>查看当前 alpine 镜像：</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo docker images|grep alpine</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><p><img alt="image-20210721170611993" src="/assets/images/image-20210721170611993-39e993613fa174b980430baef3cbe1ad.png"></p><ul><li>镜像推送到远端私有 harbor 仓库：</li></ul><div class="codeBlockContainer_ERxb"><div class="codeBlockContent_PEDJ"><pre tabindex="0" class="prism-code language-undefined codeBlock_5APD thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_WrPf"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo docker push 192.168.202.110:5000/train/alpine:latest</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TaRm clean-btn">Copy</button></div></div><p><img alt="image-20210721170702547" src="/assets/images/image-20210721170702547-6c23ef1e3c13d7745071deebc2b2ac54.png"></p><ul><li>客户机登陆 harbor，可以看到刚才 tag 的镜像就已经推送到 Harbor 仓库的 train 项目中了：</li></ul><p><img alt="image-20210721170806373" src="/assets/images/image-20210721170806373-3cf47f4e88a6600329d70aa72d0d7143.png"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/deployment/kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 部署Kubernetes集群</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/deployment/stoarge"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">部署共享存储 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_d7-6 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#整体部署" class="table-of-contents__link">整体部署</a><ul><li><a href="#安装-docker" class="table-of-contents__link">安装 docker</a></li><li><a href="#安装-docker-compose" class="table-of-contents__link">安装 docker-compose</a></li><li><a href="#安装-python-文件" class="table-of-contents__link">安装 python 文件</a></li><li><a href="#安装-harbor" class="table-of-contents__link">安装 harbor</a></li></ul></li><li><a href="#harbor-使用" class="table-of-contents__link">Harbor 使用</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/intro">平台介绍</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/manual/intro">用户手册</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/management/intro">管理员手册</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://www.yunqiic.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">云启智城</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/intro">安装流程</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Pumpkin build by 云启智城</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a24ae582.js"></script>
<script src="/assets/js/main.b78f448d.js"></script>
</body>
</html>